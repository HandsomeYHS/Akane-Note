# 消息队列——RabbitMQ

[TOC]

> 消息: 是在两台计算机间传送的数据单位。消息可以非常简单，例如只包含文本字符串；也可以更复杂，可能包含嵌入对象。
>
> 
>
> 消息队列（Message Queue）是一种应用间的通信方式，消息发送后可以立即返回，由消息系统来确保消息的可靠传递。消息发布者只管把消息发布到 MQ 中而不用管谁来取，消息使用者只管从 MQ 中取消息而不管是谁发布的。这样发布者和使用者都不用知道对方的存在。

### 1. 什么是RabbitMQ？

RabbitMQ 即一个消息队列，主要是用来实现应用程序的**异步和解耦**，同时也能起到消息缓冲，消息分发的作用。由 Erlang 语言开发的 AMQP (Advanced Message Queue，高级消息队列协议)  的开源实现。

比如：当我们点击一个下单任务时候，这个时候其实是要执行很多步骤的，而且是同步处理。但是随着数据量越来越大的时候，就会影响处理的效率。这个时候有没有办法保证数据是可靠执行的，而且又能够异步处理，这就需要消息队列了。**当生产者大量产生数据时，消费者无法快速消费，那么需要一个中间层。保存这个数据。**



### 2. 特性

- 可靠性

- 可伸缩性：集群服务
- 消息持久化：从内存持久化消息到硬盘，再从硬盘加载到内存



### 3.消息模型

![](/images/rabbitMQ.png)

publisher(消息生产者)——>Exchange(交换器)——>Binding(绑定)——>Queue(消息队列)——>conneciton(连接)——>Consumer(消息消费者)



vhost：虚拟主机，表示一批交换器、消息队列和相关对象。虚拟主机是共享相同的身份认证和加密环境的独立服务器域。每个 vhost 本质上就是一个 mini 版的 RabbitMQ 服务器，拥有自己的队列、交换器、绑定和权限机制。vhost 是 AMQP 概念的基础，必须在连接时指定，RabbitMQ 默认的 vhost 是 / 。

Exchange(交换器)：用于将消息传到队列中

**Direct Exchange**：默认模式，根据key全文匹配去寻找队列。

**Topic Exchange**：根据通配符。路由键必须是字符，用( . )隔开，路由模式必须包含一个( * )。

**Headers Exchange**：自定义key-value

**Fanout Exchange**：消息广播模式，不管路由键或者是路由模式，会把消息发给绑定给它的全部队列，如果配置了 routing_key 会被忽略。



### 4.RabbitMQ 集群

